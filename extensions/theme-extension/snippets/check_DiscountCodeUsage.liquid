<script>
// Function to get discount code usage count
async function checkDiscountCodeUsage(priceRuleId, discountCodeId) {

    try {
        const response = await fetch('/apps/giftcard', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'CHECKUSAGE',
            data: {
              priceRuleId,
              discountCodeId
            }
          })
        });
    
        const result = await response.json();
        if (result.success === true) {
          console.log(`Discount code usage: ${result.usage}`);
          return result.usage;
        } else if (result.success === false) {
          console.log(`Discount code usage: ${result.usage}`);
          return result.usage;
        } else {
            console.error(result.error)
        }
    } catch (error) {
        console.error('Error checking discount code usage:', error);
        return null;
    }

    {% comment %} if (!priceRuleId || !discountCodeId || !storeUrl || !apiVersion || !accessToken){
        console.log("invalid parameters");
        return false;
    }

    const url = `${storeUrl}/admin/api/${apiVersion}/price_rules/${priceRuleId}/discount_codes/${discountCodeId}.json`;
    try {
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'X-Shopify-Access-Token': accessToken,
          },
        })
  
        
        if (!response.ok) {
            throw new Error(`Error fetching discount code: ${response.status} - ${response.statusText}`);
        }
        
        const data = await response.json();
        return data?.discount_code?.usage_count;
    } catch (error) {
        console.error(error.message);
        return null;
    } {% endcomment %}
}
</script>
